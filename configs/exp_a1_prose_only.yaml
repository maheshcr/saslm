# EXP-A1: From Scratch, Prose Only
# Baseline experiment with custom small model trained on prose works

name: EXP-A1-prose-only
approach: from_scratch
content: prose_only
description: |
  Train a ~25M parameter GPT model from scratch on Sri Aurobindo's prose works.
  Uses weighted sampling to prioritize mature works (Life Divine, Synthesis of Yoga).
  Higher weight decay for potential grokking observation.

data:
  corpus_path: ./data/clean_prose
  include_types:
    - essay
    - letter
    - commentary
    - record
  exclude_types:
    - poetry
    - drama
  period_weights:
    mature: 3.0
    middle: 2.0
    early: 0.5
  content_weights:
    essay: 2.0
    letter: 1.5
    commentary: 1.5
  priority_works:
    # Core philosophical works
    - 21-22TheLifeDivine
    - 23-24TheSynthesisOfYoga
    # Letters (direct teaching)
    - 28LettersOnYoga-I
    - 29LettersOnYoga-II
    - 30LettersOnYoga-III
    - 31LettersOnYoga-IV
    # Commentaries (Vedic/Upanishadic)
    - 19EssaysOnTheGita
    - 15TheSecretOfTheVeda
    - 17IshaUpanishad
    - 18KenaAndOtherUpanishads
    # Essays and Records
    - 12EssaysDivineAndHuman
    - 10-11RecordOfYoga
    # Social philosophy
    - 25TheHumanCycle
  train_split: 0.95
  val_split: 0.05
  seed: 42

tokenizer:
  vocab_size: 16384
  min_frequency: 2
  tokenizer_path: ./tokenizers/tokenizer_16k
  special_tokens:
    - '[UNK]'
    - '[CLS]'
    - '[SEP]'
    - '[PAD]'
    - '[MASK]'
    - '<|endoftext|>'
  extend_base: false

model:
  architecture: gpt2-custom
  vocab_size: 16384
  n_layers: 6
  n_heads: 6
  n_embd: 384
  block_size: 512
  dropout: 0.1
  bias: false

training:
  batch_size: 32
  gradient_accumulation: 4
  effective_batch_size: 128
  learning_rate: 0.0003
  weight_decay: 0.1
  beta1: 0.9
  beta2: 0.95
  grad_clip: 1.0
  lr_scheduler: cosine
  warmup_steps: 500
  lr_decay_steps: 100000
  max_steps: 100000
  eval_interval: 500
  save_interval: 1000
  sample_interval: 2000

grokking:
  enabled: true
  detection_window: 500
  detection_threshold: 0.15
  plateau_variance_threshold: 0.02
  train_val_gap_threshold: 0.5

hardware:
  device: auto
  precision: fp16
  num_workers: 4
  pin_memory: true
  mount_drive: true
  drive_path: /content/drive/MyDrive/saslm/experiments
